<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <title>Hacker Console — JS → Python → JSON → Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --bg: #06080b;
            --fg: #e8ecef;
            --panel: #0b0f13;
        }

        html, body {
            height: 100%;
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            font-family: Consolas,Menlo,Monaco,monospace
        }

        .wrap {
            max-width: 980px;
            margin: 28px auto;
            padding: 12px
        }

        .screen {
            background: linear-gradient(180deg,#0008,#0b0f1388);
            border: 1px solid #10161c;
            border-radius: 8px;
            min-height: 420px;
            padding: 14px;
            box-shadow: 0 10px 30px #0008;
            overflow: auto
        }

        pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
            font-size: 14px
        }

        .controls {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center
        }

            .controls input {
                width: 110px;
                padding: 6px;
                border-radius: 6px;
                border: none;
                background: #0f1419;
                color: #d8d8d8
            }

            .controls button {
                padding: 6px 10px;
                border-radius: 6px;
                border: none;
                background: #1e242b;
                color: #e8e8e8;
                cursor: pointer
            }

        .hdr {
            color: #9aff9d;
            margin: 0 0 8px 0;
            opacity: .95
        }

        .line span {
            font-weight: 600;
            text-shadow: 0 0 10px currentColor
        }

        small.status {
            display: block;
            margin-top: 8px;
            color: #7b8a8d
        }
    </style>
</head>
<body>
    <div class="wrap">
        <h3 class="hdr">>>> JS (server) → Python → JSON → Browser</h3>
        <div id="screen" class="screen"><pre id="out">Clique "Start" ou "One".</pre></div>

        <div class="controls">
            <label>
                Interval (ms)
                <input id="ms" type="number" min="100" step="100" value="900">
            </label>
            <button id="start">Start</button>
            <button id="stop" disabled>Stop</button>
            <button id="one">One</button>
            <button id="clear">Clear</button>
            <small class="status" id="status">Statut: prêt</small>
        </div>
    </div>

    <!-- Script to send console.log to the server via sendLog.js-->
    <script src="./api/sendLog.js"></script>

    <script>
        (() => {
            const out = document.getElementById("out");
            const statusEl = document.getElementById("status");
            const msInput = document.getElementById("ms");
            const startBtn = document.getElementById("start");
            const stopBtn = document.getElementById("stop");
            const oneBtn = document.getElementById("one");
            const clearBtn = document.getElementById("clear");

            const PALETTE = ["#39ff14", "#00ffff", "#ffd166", "#ff6b6b", "#a0e7e5", "#b9f18a", "#b388ff", "#64ffda"];
            let timer = null;

            function colorizeBlock(text) {
                return text.split("\\n").map(line => {
                    const c = PALETTE[Math.floor(Math.random() * PALETTE.length)];
                    return `<div class="line"><span style="color:${c}">${line.replace(/</g, "&lt;")}</span></div>`;
                }).join("\\n");
            }

            async function fetchSnippet() {
                sendLog("Fetching Python snippet /run_python_hacker_snippet");
                try {
                    const resp = await fetch("../run_python_hacker_snippet", { cache: "no-store" });
                    if (!resp.ok) throw new Error("HTTP " + resp.status);
                    const { code } = await resp.json();
                    out.insertAdjacentHTML("beforeend", colorizeBlock(code) + "\\n");
                    out.parentElement.scrollTop = out.parentElement.scrollHeight;
                    statusEl.textContent = "Statut: OK";
                } catch (err) {
                    const msg = `[fetch error] ${err.message || err}`;
                    out.insertAdjacentHTML("beforeend", `<div class="line"><span style="color:#ff6b6b">${msg}</span></div>\\n`);
                    statusEl.textContent = "Statut: erreur";
                    console.error(err);
                }
                sendLog("Fetch complete");
            }

            function startLoop() {
                if (timer) return;
                startBtn.disabled = true; stopBtn.disabled = false; msInput.disabled = true;
                fetchSnippet();
                timer = setInterval(fetchSnippet, Math.max(100, Number(msInput.value) || 900));
                statusEl.textContent = "Statut: en cours";
            }

            function stopLoop() {
                if (!timer) return;
                clearInterval(timer); timer = null;
                startBtn.disabled = false; stopBtn.disabled = true; msInput.disabled = false;
                statusEl.textContent = "Statut: arrêté";
            }

            startBtn.addEventListener("click", startLoop);
            stopBtn.addEventListener("click", stopLoop);
            oneBtn.addEventListener("click", fetchSnippet);
            clearBtn.addEventListener("click", () => { out.textContent = ""; statusEl.textContent = "Statut: prêt"; });
        })();
    </script>
</body>
</html>
